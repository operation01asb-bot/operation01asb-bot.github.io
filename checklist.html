<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Checklist</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="sidebar dark">
    <h3>Onboarding Portal</h3>
    <ul>
        <li><a href="dashboard.html">Welcome</a></li>
        <li class="active"><a href="checklist.html">Checklist</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="progress.html">Progress</a></li>
        <li id="adminOnly" style="display:none;"><a href="admin.html">Admin Panel</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
    </ul>
</div>

<div class="content-area">
    <h1>Onboarding Checklist</h1>
    <p>Your tasks for Week 1â€“2.</p>

    <ul class="checklist-box" id="taskList">
        <!-- Tasks will load from Firestore -->
    </ul>

</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { 
    onAuthStateChanged, 
    signOut 
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

import {
    doc, getDoc, setDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

let currentUID = null;

onAuthStateChanged(auth, async (user) => {
    if (!user) window.location.href = "index.html";

    currentUID = user.uid;

    const userSnap = await getDoc(doc(db, "users", user.uid));
    if (userSnap.data().role === "admin") {
        document.getElementById("adminOnly").style.display = "block";
    }

    loadTasks();
});

async function loadTasks() {
    const taskSnap = await getDoc(doc(db, "checklist", "default"));
    let tasks = taskSnap.exists() ? taskSnap.data().tasks : [];

    const userSnap = await getDoc(doc(db, "users", currentUID));
    let completed = userSnap.data().completedTasks || [];

    let html = "";
    tasks.forEach((t, i) => {
        let checked = completed.includes(i) ? "checked" : "";
        html += `
        <li>
            <input type="checkbox" data-id="${i}" ${checked} onclick="toggleTask(${i})">
            <span>${t}</span>
        </li>`;
    });

    document.getElementById("taskList").innerHTML = html;
}

window.t
